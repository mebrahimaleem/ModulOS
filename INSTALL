# Installing Instructions

The ModulOS image can be built by running the `make` command in the root directory of the source tree. This will create the `obj/modulos.img` which can be copied to a drive. Optionally, debugging symbols can be found in `obj/modulos-dbg`.

By default, debugging related logging is disabled and optimizations are enabled. This can be changed by uncommenting the line `#DEBUG := 1` in the top level Makefile.

The built modules can be customized by commenting/uncommenting the various BUILD_<MODULENAME> lines near the beginning of the top level Makefile

## Cross Compilation Instructions

- binutils 2.45 was build with the following configuration: `--target=x86_64-elf --program-prefix=x86_64-elf- --with-sysroot --disable-nls --disable-werror`

- gcc 15.2.0 was build with the following configuration: `--target=x86_64-elf --program-prefix=x86_64-elf- --disable-nls --enable-languages=c --without-headers`

- Patch files can be found in `contrib/patch/`

The compiler and binutils should be built in the following order:

1. Build and install binutils: `make && make install`
2. Patch gcc source using noredzone.patch
3. Build and install gcc: `make all-gcc && make install-gcc`
4. Try building libgcc (this will fail due to PIC being enabled): `make all-target-libgcc CFLAGS_FOR_TARGET='-g -O2 -mcmodel=kernel' || true`
5. Patch gcc `objdir/x86_64-elf/libgcc/Makefile`: `sed -i 's/PICFLAG/DISABLED_PICFLAG/g' x86_64-elf/libgcc/Makefile`
6. Patch gcc `objdir/x86_64-elf/libgcc-noredzone/libgcc/Makefile`: `sed -i 's/PICFLAG/DISABLED_PICFLAG/g' x86_64-elf/libgcc-noredzone/libgcc/Makefile`
7. Rebuild and install libgcc: `make all-target-libgcc CFLAGS_FOR_TARGET='-g -O2 -mcmodel=kernel' && make install-target-libgcc`

Optionally, gdb can be built the same way as binutils
